<VirtualHost *:80>
    ServerAdmin admin@keyed.sh
    DocumentRoot "/var/www/html"
    ServerName keyed.sh
    ErrorLog /var/log/apache2/tube-error.log
    CustomLog /var/log/apache2/tube-access.log combined

    <Directory "/var/www/html">
    	Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Order allow,deny
        Allow from all
        Require all granted
    </Directory>
     
	RewriteEngine on
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI}

	RewriteRule ^/?$ /index.php [L]
	RewriteRule ^([^.?]+)$ %{REQUEST_URI}.php [L]
	RewriteCond %{THE_REQUEST} "^[^ ]* .*?\.php[? ].*$"
	RewriteRule .* - [L,R=404]
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin admin@keyed.sh
    DocumentRoot "/var/www/html"
    ServerName keyed.sh
    ErrorLog /var/log/apache2/tube-error.log
    CustomLog /var/log/apache2/tube-access.log combined

    <Directory "/var/www/html">
    	Options Indexes FollowSymLinks Includes ExecCGI
        AllowOverride All
        Order allow,deny
        Allow from all
        Require all granted
    </Directory>

    SSLCertificateFile /etc/letsencrypt/live/keyed.sh/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/keyed.sh/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

	RewriteEngine on
	RewriteRule ^/?$ /index.php [L]
	RewriteRule ^([^.?]+)$ %{REQUEST_URI}.php [L]
	RewriteCond %{THE_REQUEST} "^[^ ]* .*?\.php[? ].*$"
	RewriteRule .* - [L,R=404]
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet